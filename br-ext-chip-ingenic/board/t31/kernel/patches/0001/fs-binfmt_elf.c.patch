
--- a/fs/binfmt_elf.c
+++ b/fs/binfmt_elf.c
@@ -1032,6 +1032,8 @@ static int load_elf_library(struct file *file)
 	if (elf_ex.e_type != ET_EXEC || elf_ex.e_phnum > 2 ||
 	    !elf_check_arch(&elf_ex) || !file->f_op || !file->f_op->mmap)
 		goto out;
+	if (!elf_lib_check_arch(&elf_ex))
+		goto out;
 
 	/* Now read in all of the header information */
 
